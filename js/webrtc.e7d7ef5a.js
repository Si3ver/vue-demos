(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["webrtc"],{"0293":function(e,t,n){"use strict";n("4bdd")},"25f0":function(e,t,n){"use strict";var o=n("6eeb"),r=n("825a"),a=n("d039"),i=n("ad6d"),c="toString",s=RegExp.prototype,u=s[c],d=a((function(){return"/a/b"!=u.call({source:"a",flags:"b"})})),l=u.name!=c;(d||l)&&o(RegExp.prototype,c,(function(){var e=r(this),t=String(e.source),n=e.flags,o=String(void 0===n&&e instanceof RegExp&&!("flags"in s)?i.call(e):n);return"/"+t+"/"+o}),{unsafe:!0})},"466d":function(e,t,n){"use strict";var o=n("d784"),r=n("825a"),a=n("50c4"),i=n("1d80"),c=n("8aa5"),s=n("14c3");o("match",(function(e,t,n){return[function(t){var n=i(this),o=void 0==t?void 0:t[e];return void 0!==o?o.call(t,n):new RegExp(t)[e](String(n))},function(e){var o=n(t,this,e);if(o.done)return o.value;var i=r(this),u=String(e);if(!i.global)return s(i,u);var d=i.unicode;i.lastIndex=0;var l,f=[],p=0;while(null!==(l=s(i,u))){var g=String(l[0]);f[p]=g,""===g&&(i.lastIndex=c(u,a(i.lastIndex),d)),p++}return 0===p?null:f}]}))},"4bdd":function(e,t,n){},"4d63":function(e,t,n){var o=n("83ab"),r=n("da84"),a=n("94ca"),i=n("7156"),c=n("9112"),s=n("9bf2").f,u=n("241c").f,d=n("44e7"),l=n("ad6d"),f=n("9f7f"),p=n("6eeb"),g=n("d039"),m=n("5135"),v=n("69f3").enforce,h=n("2626"),b=n("b622"),w=n("fce3"),x=n("107c"),y=b("match"),E=r.RegExp,R=E.prototype,S=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,U=/a/g,C=/a/g,D=new E(U)!==U,O=f.UNSUPPORTED_Y,T=o&&(!D||O||w||x||g((function(){return C[y]=!1,E(U)!=U||E(C)==C||"/a/i"!=E(U,"i")}))),I=function(e){for(var t,n=e.length,o=0,r="",a=!1;o<=n;o++)t=e.charAt(o),"\\"!==t?a||"."!==t?("["===t?a=!0:"]"===t&&(a=!1),r+=t):r+="[\\s\\S]":r+=t+e.charAt(++o);return r},M=function(e){for(var t,n=e.length,o=0,r="",a=[],i={},c=!1,s=!1,u=0,d="";o<=n;o++){if(t=e.charAt(o),"\\"===t)t+=e.charAt(++o);else if("]"===t)c=!1;else if(!c)switch(!0){case"["===t:c=!0;break;case"("===t:S.test(e.slice(o+1))&&(o+=2,s=!0),r+=t,u++;continue;case">"===t&&s:if(""===d||m(i,d))throw new SyntaxError("Invalid capture group name");i[d]=!0,a.push([d,u]),s=!1,d="";continue}s?d+=t:r+=t}return[r,a]};if(a("RegExp",T)){for(var N=function(e,t){var n,o,r,a,s,u,f=this instanceof N,p=d(e),g=void 0===t,m=[],h=e;if(!f&&p&&g&&e.constructor===N)return e;if((p||e instanceof N)&&(e=e.source,g&&(t="flags"in h?h.flags:l.call(h))),e=void 0===e?"":String(e),t=void 0===t?"":String(t),h=e,w&&"dotAll"in U&&(o=!!t&&t.indexOf("s")>-1,o&&(t=t.replace(/s/g,""))),n=t,O&&"sticky"in U&&(r=!!t&&t.indexOf("y")>-1,r&&(t=t.replace(/y/g,""))),x&&(a=M(e),e=a[0],m=a[1]),s=i(E(e,t),f?this:R,N),(o||r||m.length)&&(u=v(s),o&&(u.dotAll=!0,u.raw=N(I(e),n)),r&&(u.sticky=!0),m.length&&(u.groups=m)),e!==h)try{c(s,"source",""===h?"(?:)":h)}catch(b){}return s},k=function(e){e in N||s(N,e,{configurable:!0,get:function(){return E[e]},set:function(t){E[e]=t}})},A=u(E),P=0;A.length>P;)k(A[P++]);R.constructor=N,N.prototype=R,p(r,"RegExp",N)}h("RegExp")},7156:function(e,t,n){var o=n("861d"),r=n("d2bb");e.exports=function(e,t,n){var a,i;return r&&"function"==typeof(a=t.constructor)&&a!==n&&o(i=a.prototype)&&i!==n.prototype&&r(e,i),e}},"72a0":function(e,t,n){"use strict";n.r(t);var o,r,a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chatroom"},[e._v(" 房间地址："),n("input",{directives:[{name:"model",rawName:"v-model",value:e.roomUrl,expression:"roomUrl"}],staticClass:"roomUrl",attrs:{readonly:"true"},domProps:{value:e.roomUrl},on:{input:function(t){t.target.composing||(e.roomUrl=t.target.value)}}}),n("br"),n("video",{attrs:{width:"640px",height:"480px",id:"myVideo"}}),n("video",{attrs:{width:"240px",height:"160px",id:"remoteVideo"}})])},i=[],c=n("1da1"),s=(n("96cf"),n("ac1f"),n("1276"),n("4d63"),n("25f0"),n("466d"),{name:"userMedia",data:function(){return{roomUrl:"",roomName:""}},mounted:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$nextTick((function(){var t=e.getUrlParam("room");t?(e.roomName="observable-"+t.split("-")[1],e.roomUrl=location.href):(e.roomName="observable-"+Date.now(),e.roomUrl=location.href+"?room=".concat(e.roomName)),e.start()}));case 1:case"end":return t.stop()}}),t)})))()},methods:{getUrlParam:function(e){var t=new RegExp("(\\?|&)"+e+"=([^&]*)(&|$)"),n=window.location.href.substr(1).match(t);return null!=n?unescape(n[2]):null},start:function(){var e=this;o=new window.ScaleDrone("OXo4HSBTCQ8ehrxI"),o.on("open",(function(t){if(t)return console.error(t);var n=o.subscribe(e.roomName);n.on("open",(function(e){e&&this.onError(e)})),n.on("members",(function(t){console.log("MEMBERS",t);var n=2===t.length;e.startWebRTC(n)})),n.on("data",(function(t,n){n.id!==o.clientId&&(t.sdp?(console.log("sdp消息：",t),r.setRemoteDescription(new RTCSessionDescription(t.sdp),(function(){console.log("sdp消息类型：",r.remoteDescription.type),"offer"===r.remoteDescription.type&&r.createAnswer().then((function(t){r.setLocalDescription(t,(function(){e.sendMessage({sdp:r.localDescription})}),e.onError)})).catch(e.onError)}),e.onError)):t.candidate&&(console.log("candidate消息：",t),r.addIceCandidate(new RTCIceCandidate(t.candidate))))}))}))},startWebRTC:function(e){var t=this,n={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};console.log("startWebRTC, connect to stun server"),r=new RTCPeerConnection(n),r.onicecandidate=function(e){e.candidate&&(console.log(">>>>onicecandidate"),t.sendMessage({candidate:e.candidate}))},e&&(r.onnegotiationneeded=function(){r.createOffer().then((function(e){r.setLocalDescription(e,(function(){t.sendMessage({sdp:r.localDescription})}),t.onError)})).catch(t.onError)}),r.onaddstream=function(e){document.querySelector("#remoteVideo").srcObject=e.stream;var t=document.querySelector("#myVideo");t.srcObject=e.stream,t.play()},window.navigator.getUserMedia({audio:!0,video:!0},(function(e){var t=document.querySelector("#myVideo");console.log("start local stream"),t.srcObject=e,t.play(),r.addStream(e)}),this.onError)},sendMessage:function(e){o.publish({room:this.roomName,message:e})},onError:function(e){console.log(e)}}}),u=s,d=(n("0293"),n("2877")),l=Object(d["a"])(u,a,i,!1,null,"399cbde2",null);t["default"]=l.exports}}]);
//# sourceMappingURL=webrtc.e7d7ef5a.js.map