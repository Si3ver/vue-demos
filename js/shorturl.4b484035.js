(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["shorturl"],{"10be":function(e,t,r){"use strict";r("e660")},a15b:function(e,t,r){"use strict";var n=r("23e7"),o=r("e330"),c=r("44ad"),u=r("fc6a"),s=r("a640"),a=o([].join),i=c!=Object,l=s("join",",");n({target:"Array",proto:!0,forced:i||!l},{join:function(e){return a(u(this),void 0===e?",":e)}})},a640:function(e,t,r){"use strict";var n=r("d039");e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){throw 1},1)}))}},a89f:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"shortURL"},[r("section",{staticClass:"tool"},[r("a",{on:{click:e.showAllData}},[e._v("索引数据")])]),r("section",{staticClass:"input"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.longUrl,expression:"longUrl"}],domProps:{value:e.longUrl},on:{input:function(t){t.target.composing||(e.longUrl=t.target.value)}}}),r("a",{staticClass:"btn",on:{click:e.doShort}},[e._v("生成短网址")])]),r("section",[e._v(e._s(e.shortUrl))]),r("section",{staticClass:"indexData"},e._l(e.values,(function(t){return r("div",{key:t.id,staticClass:"url-item"},[e._v(" "+e._s(t.urlKey)+", "+e._s(t.url)+" ")])})),0)])},o=[],c=r("1da1"),u=(r("96cf"),r("ac1f"),r("1276"),r("a15b"),r("d3b7"),r("ddb0"),"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-+".split("")),s={name:"shortURL",data:function(){return{db:null,longUrl:"",shortUrl:"",values:[]}},created:function(){this.createDB(),console.log(this.to64(64))},methods:{createDB:function(){var e=this,t=window.indexedDB.open("shortURL",1);t.onerror=function(e){console.log(e)},t.onsuccess=function(t){e.db=t.target.result},t.onupgradeneeded=function(t){e.db=t.target.result;var r=e.db.createObjectStore("shortURLs",{keyPath:"id",autoIncrement:!0});r.createIndex("url","url",{unique:!1}),r.createIndex("urlKey","urlKey",{unique:!1}),console.log("Database setup complete")}},doShort:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.longUrl){t.next=2;break}return t.abrupt("return");case 2:e.db?(r=e.getObjectStore(),r.add({url:e.longUrl}).onsuccess=function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=r.target.result,console.log("add sucess>>",n),t.next=4,e.shorten(n);case 4:e.shortUrl=t.sent,e.shortUrl="https://a.b/"+e.shortUrl;case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()):console.log("error");case 3:case"end":return t.stop()}}),t)})))()},getObjectStore:function(){return this.db.transaction(["shortURLs"],"readwrite").objectStore("shortURLs")},shorten:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.query(e);case 2:return n=r.sent,n.urlKey=t.to64(e),t.update(n),r.abrupt("return",n.urlKey);case 6:case"end":return r.stop()}}),r)})))()},to64:function(e){var t=[],r=e;while(r>63)t.push(u[r%64]),r=Math.floor(r/64);return t.push(u[r]),t.reverse().join("")},add:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=t.getObjectStore(),o=n.add(e),o.onsuccess=function(){return console.log("数据写入成功!"),!0},o.onerror=function(){console.log("数据写入失败!")};case 4:case"end":return r.stop()}}),r)})))()},update:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=t.getObjectStore(),o=n.put(e),o.onsuccess=function(){console.log("数据更新成功!")},o.onerror=function(){console.log("数据更新失败!")};case 4:case"end":return r.stop()}}),r)})))()},remove:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=t.getObjectStore(),o=n.delete(e),o.onsuccess=function(){console.log("数据删除成功!")},o.onerror=function(){console.log("数据删除失败!")};case 4:case"end":return r.stop()}}),r)})))()},query:function(e){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,n){var o=t.getObjectStore(),c=o.get(e);c.onsuccess=function(e){console.log(e),r(e.target.result)},c.onerror=function(e){console.log(e),console.log("数据查询失败!"),n(e)}})));case 1:case"end":return r.stop()}}),r)})))()},queryAll:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var r=e.getObjectStore(),n=[];r.openCursor().onsuccess=function(e){var r=e.target.result;r?(n.push(r.value),r.continue()):(console.log("done",n),t(n))}})));case 1:case"end":return t.stop()}}),t)})))()},showAllData:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.queryAll();case 2:e.values=t.sent;case 3:case"end":return t.stop()}}),t)})))()}}},a=s,i=(r("10be"),r("2877")),l=Object(i["a"])(a,n,o,!1,null,"ceac51c0",null);t["default"]=l.exports},e660:function(e,t,r){}}]);
//# sourceMappingURL=shorturl.4b484035.js.map